{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/app/lib/youtubeTranscript.ts"],"sourcesContent":["// import ytdl from '@distube/ytdl-core';\r\n\r\nexport async function getYouTubeTranscript(videoId: string): Promise<string> {\r\n  const minText = (str: string) => str.replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&#39;/g, \"'\");\r\n  const USER_AGENT = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36';\r\n\r\n  let sessionCookies: string[] = [];\r\n\r\n  const log = (msg: string) => {\r\n      try { console.log(msg.replace(/[^\\x00-\\x7F]/g, \"?\")); } catch {}\r\n  };\r\n\r\n  const fetchUrl = async (url: string): Promise<string> => {\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), 10000); // 10s timeout\r\n      \r\n      try {\r\n          const headers: HeadersInit = {\r\n              'User-Agent': USER_AGENT,\r\n              'Accept-Language': 'en-US,en;q=0.9',\r\n              'Referer': `https://www.youtube.com/watch?v=${videoId}`,\r\n          };\r\n\r\n          if (sessionCookies.length > 0) {\r\n              headers['Cookie'] = sessionCookies.join('; ');\r\n          }\r\n\r\n          const response = await fetch(url, {\r\n              headers,\r\n              signal: controller.signal\r\n          });\r\n          clearTimeout(timeoutId);\r\n\r\n          if (!response.ok) {\r\n              throw new Error(`Fetch failed: ${response.status}`);\r\n          }\r\n          \r\n          // Extract Set-Cookie\r\n          // Node 18+ uses headers.getSetCookie()\r\n          // @ts-ignore\r\n          if (typeof response.headers.getSetCookie === 'function') {\r\n               // @ts-ignore\r\n               const newCookies = response.headers.getSetCookie() as string[];\r\n               if (newCookies && newCookies.length) {\r\n                   sessionCookies = [...sessionCookies, ...newCookies];\r\n               }\r\n          } else {\r\n              // Fallback\r\n              const newCookie = response.headers.get('set-cookie');\r\n              if (newCookie) {\r\n                  sessionCookies.push(newCookie);\r\n              }\r\n          }\r\n\r\n          return await response.text();\r\n      } catch (error: any) {\r\n          clearTimeout(timeoutId);\r\n          throw error;\r\n      }\r\n  };\r\n\r\n  let info: any;\r\n  let method = 'scrape';\r\n\r\n  try {\r\n    log(`[Transcript] Fetching info for video ${videoId}...`);\r\n\r\n    try {\r\n        log('[Transcript] Starting manual scrape...');\r\n        const html = await fetchUrl(`https://www.youtube.com/watch?v=${videoId}`);\r\n\r\n        // Try extracting ytInitialPlayerResponse\r\n        let jsonMatch = html.match(/ytInitialPlayerResponse\\s*=\\s*({.+?});/);\r\n        if (!jsonMatch) {\r\n            jsonMatch = html.match(/var\\s+ytInitialPlayerResponse\\s*=\\s*({.+?});/);\r\n        }\r\n        \r\n        if (jsonMatch) {\r\n            info = { player_response: JSON.parse(jsonMatch[1]) };\r\n        } else {\r\n             throw new Error('Could not scrape ytInitialPlayerResponse');\r\n        }\r\n    } catch (scrapeError: any) {\r\n        throw new Error(`Manual scrape failed: ${scrapeError.message}`);\r\n    }\r\n\r\n    const captions = info.player_response.captions?.playerCaptionsTracklistRenderer?.captionTracks;\r\n    if (!captions || captions.length === 0) {\r\n        throw new Error('No captions found for this video.');\r\n    }\r\n\r\n    const track = captions.find((t: any) => t.languageCode === 'en') || captions[0];\r\n    log(`[Transcript] Found caption track (${track.languageCode})`);\r\n\r\n    const transcriptUrl = track.baseUrl as string;\r\n    if (!transcriptUrl) throw new Error('No transcript URL found');\r\n\r\n    // Fetch XML\r\n    let parsedText = '';\r\n    try {\r\n        const xml = await fetchUrl(transcriptUrl);\r\n        const regex = /<text[^>]*>([^<]*)<\\/text>/g;\r\n        let match;\r\n        while ((match = regex.exec(xml)) !== null) {\r\n            if (match[1]) parsedText += minText(match[1]) + ' ';\r\n        }\r\n        parsedText = parsedText.trim();\r\n    } catch (e: any) {\r\n        log(`[Transcript] XML fetch failed: ${e.message}`);\r\n    }\r\n\r\n    // Fetch JSON3 fallback\r\n    if (!parsedText) {\r\n        log('[Transcript] XML empty. Trying fmt=json3...');\r\n        try {\r\n            const jsonStr = await fetchUrl(`${transcriptUrl}&fmt=json3`);\r\n            try {\r\n                const json = JSON.parse(jsonStr);\r\n                if (json?.events) {\r\n                    parsedText = json.events\r\n                        .map((e: any) => e.segs ? e.segs.map((s: any) => s.utf8).join('') : '').join(' ').trim();\r\n                }\r\n            } catch {\r\n                log('[Transcript] JSON3 parse failed or empty body');\r\n            }\r\n        } catch (e: any) {\r\n            log(`[Transcript] JSON3 fetch failed: ${e.message}`);\r\n        }\r\n    }\r\n\r\n    if (!parsedText) throw new Error('Parsed transcript is empty. The video might restrict caption access.');\r\n    return parsedText;\r\n\r\n  } catch (error: any) {\r\n    if (error.message.includes('Parsed transcript is empty') || error.message.includes('No captains found')) {\r\n        log('[Transcript] Node fetch failed. Trying Python fallback...');\r\n        try {\r\n            const { spawn } = await import('child_process');\r\n            const pythonProcess = spawn('python', ['scripts/get_transcript.py', videoId]);\r\n            \r\n            let dataString = '';\r\n            let errorString = '';\r\n\r\n            for await (const chunk of pythonProcess.stdout) {\r\n                dataString += chunk;\r\n            }\r\n            \r\n            for await (const chunk of pythonProcess.stderr) {\r\n                errorString += chunk;\r\n            }\r\n\r\n            const exitCode = await new Promise((resolve) => {\r\n                pythonProcess.on('close', resolve);\r\n            });\r\n\r\n            if (exitCode !== 0) {\r\n                 throw new Error(`Python script exited with code ${exitCode}: ${errorString}`);\r\n            }\r\n\r\n            const result = JSON.parse(dataString);\r\n            if (result.success) {\r\n                return result.transcript;\r\n            } else {\r\n                throw new Error(result.error);\r\n            }\r\n\r\n        } catch (pyError: any) {\r\n             throw new Error(`Python fallback failed: ${pyError.message}`);\r\n        }\r\n    }\r\n\r\n    console.error('[Transcript] Error:', error.message);\r\n    throw new Error(`Failed to fetch transcript: ${error.message}`);\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/app/lib/geminiAI.ts"],"sourcesContent":["import { GoogleGenerativeAI } from '@google/generative-ai';\r\n\r\n// This reads from environment variables - NEVER// Initialize Gemini API\r\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || '');\r\n\r\nexport async function generateSummary(transcript: string): Promise<string> {\r\n  if (!process.env.GEMINI_API_KEY) {\r\n    throw new Error('GEMINI_API_KEY is not set');\r\n  }\r\n\r\n  const prompt = `\r\n    You are an expert video summarizer.\r\n    Summarize the following YouTube video transcript in a concise, bullet-point format.\r\n    Highlight the key takeaways and important details.\r\n    \r\n    Transcript:\r\n    ${transcript.substring(0, 30000)} // Limit length to avoid token limits\r\n  `;\r\n\r\n  try {\r\n    // Try Flash model first\r\n    const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\r\n    const result = await model.generateContent(prompt);\r\n    return result.response.text();\r\n  } catch (error: any) {\r\n    console.warn('Gemini 1.5 Flash failed, retrying with Gemini Pro...', error.message);\r\n    try {\r\n        // Fallback to Gemini Pro\r\n        const modelPro = genAI.getGenerativeModel({ model: \"gemini-pro\" });\r\n        const resultPro = await modelPro.generateContent(prompt);\r\n        return resultPro.response.text();\r\n    } catch (finalError: any) {\r\n        console.error('Gemini API Error:', finalError);\r\n        throw new Error(`AI Generation Failed: ${finalError.message}. Check your API Key.`);\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,wEAAwE;AACxE,MAAM,QAAQ,IAAI,sLAAkB,CAAC,QAAQ,GAAG,CAAC,cAAc,IAAI;AAE5D,eAAe,gBAAgB,UAAkB;IACtD,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,SAAS,CAAC;;;;;;IAMd,EAAE,WAAW,SAAS,CAAC,GAAG,OAAO;EACnC,CAAC;IAED,IAAI;QACF,wBAAwB;QACxB,MAAM,QAAQ,MAAM,kBAAkB,CAAC;YAAE,OAAO;QAAmB;QACnE,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;QAC3C,OAAO,OAAO,QAAQ,CAAC,IAAI;IAC7B,EAAE,OAAO,OAAY;QACnB,QAAQ,IAAI,CAAC,wDAAwD,MAAM,OAAO;QAClF,IAAI;YACA,yBAAyB;YACzB,MAAM,WAAW,MAAM,kBAAkB,CAAC;gBAAE,OAAO;YAAa;YAChE,MAAM,YAAY,MAAM,SAAS,eAAe,CAAC;YACjD,OAAO,UAAU,QAAQ,CAAC,IAAI;QAClC,EAAE,OAAO,YAAiB;YACtB,QAAQ,KAAK,CAAC,qBAAqB;YACnC,MAAM,IAAI,MAAM,CAAC,sBAAsB,EAAE,WAAW,OAAO,CAAC,qBAAqB,CAAC;QACtF;IACF;AACF"}},
    {"offset": {"line": 254, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/app/api/summarize/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { getYouTubeTranscript } from '@/app/lib/youtubeTranscript';\r\nimport { generateSummary } from '@/app/lib/geminiAI';\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { videoId } = await request.json();\r\n\r\n    if (!videoId) {\r\n      return NextResponse.json(\r\n        { error: 'Video ID is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if Gemini API key is configured\r\n    if (!process.env.GEMINI_API_KEY) {\r\n      return NextResponse.json(\r\n        { error: 'Gemini API key not configured. Please add GEMINI_API_KEY to environment variables.' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Get transcript\r\n    const transcript = await getYouTubeTranscript(videoId);\r\n    \r\n    // Generate AI summary\r\n    const summary = await generateSummary(transcript);\r\n    \r\n    return NextResponse.json({ \r\n      summary,\r\n      transcript_length: transcript.length\r\n    });\r\n    \r\n  } catch (error: any) {\r\n    console.error('Summarization error:', error);\r\n    return NextResponse.json(\r\n      { \r\n        error: error.message || 'Failed to summarize video',\r\n        details: 'The video might not have captions or the API key might be invalid'\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEtC,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAElB;QAEA,wCAAwC;QACxC,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;YAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqF,GAC9F;gBAAE,QAAQ;YAAI;QAElB;QAEA,iBAAiB;QACjB,MAAM,aAAa,MAAM,IAAA,yJAAoB,EAAC;QAE9C,sBAAsB;QACtB,MAAM,UAAU,MAAM,IAAA,2IAAe,EAAC;QAEtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA,mBAAmB,WAAW,MAAM;QACtC;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO,MAAM,OAAO,IAAI;YACxB,SAAS;QACX,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}