{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/lib/db.ts"],"sourcesContent":["import { Pool } from \"pg\";\r\n\r\nlet pool: Pool;\r\n\r\nif (!process.env.DATABASE_URL) {\r\n  throw new Error(\r\n    \"Please define the DATABASE_URL environment variable inside .env\",\r\n  );\r\n}\r\n\r\nconst poolConfig = {\r\n  connectionString: process.env.DATABASE_URL,\r\n  ssl: {\r\n    rejectUnauthorized: false\r\n  },\r\n  max: 10, // Limit pool size to default Neon limit for free tier\r\n  idleTimeoutMillis: 30000,\r\n  connectionTimeoutMillis: 5000,\r\n};\r\n\r\nif (process.env.NODE_ENV === 'production') {\r\n  pool = new Pool(poolConfig);\r\n} else {\r\n  // In development mode, use a global variable so that the value\r\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\r\n  if (!(global as any).pgPool) {\r\n    (global as any).pgPool = new Pool(poolConfig);\r\n  }\r\n  pool = (global as any).pgPool;\r\n}\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,IAAI;AAEJ,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MACR;AAEJ;AAEA,MAAM,aAAa;IACjB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;QACH,oBAAoB;IACtB;IACA,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAEA;;KAEO;IACL,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,CAAC,yDAAgB,MAAM,EAAE;QAC3B,yDAAgB,MAAM,GAAG,IAAI,qJAAI,CAAC;IACpC;IACA,OAAO,yDAAgB,MAAM;AAC/B;uCAEe"}},
    {"offset": {"line": 315, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/lib/auth.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'development_secret_key_123';\r\n\r\nif (process.env.NODE_ENV === 'production' && !process.env.JWT_SECRET) {\r\n  throw new Error('JWT_SECRET must be set in production environment');\r\n}\r\n\r\nexport async function hashPassword(password: string): Promise<string> {\r\n  const salt = await bcrypt.genSalt(10);\r\n  return bcrypt.hash(password, salt);\r\n}\r\n\r\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\r\n  return bcrypt.compare(password, hash);\r\n}\r\n\r\nexport function generateToken(payload: any): string {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '1d' });\r\n}\r\n\r\nexport function verifyToken(token: string): any {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE7C;;AAIO,eAAe,aAAa,QAAgB;IACjD,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;IAClC,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,cAAc,OAAY;IACxC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 357, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/app/api/summarize/route.ts"],"sourcesContent":["\r\nimport { NextResponse } from 'next/server';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport ytdl from '@distube/ytdl-core';\r\nimport pool from '@/lib/db';\r\nimport { verifyToken } from '@/lib/auth';\r\nimport { cookies } from 'next/headers';\r\n\r\n// Initialize Gemini API\r\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || '');\r\nconst model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    // 1. Authentication Check\r\n    const cookieStore = await cookies();\r\n    const token = cookieStore.get('token')?.value;\r\n\r\n    if (!token) {\r\n      return NextResponse.json({ message: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const payload = verifyToken(token);\r\n    if (!payload || !payload.id) {\r\n      return NextResponse.json({ message: 'Invalid token' }, { status: 401 });\r\n    }\r\n\r\n    if (payload.status !== 'approved') {\r\n      return NextResponse.json({ message: 'Account is not approved' }, { status: 403 });\r\n    }\r\n\r\n    const userId = payload.id;\r\n\r\n    // 2. Parse Request\r\n    const { videoUrl } = await req.json();\r\n\r\n    if (!videoUrl) {\r\n      return NextResponse.json({ message: 'Video URL is required' }, { status: 400 });\r\n    }\r\n\r\n    // 3. Extract Video ID\r\n    const videoIdMatch = videoUrl.match(/(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/\\s]{11})/);\r\n    const videoId = videoIdMatch ? videoIdMatch[1] : null;\r\n\r\n    if (!videoId) {\r\n      return NextResponse.json({ message: 'Invalid YouTube URL' }, { status: 400 });\r\n    }\r\n\r\n    // 4. Fetch Transcript\r\n    // 4. Fetch Transcript (Robust method using @distube/ytdl-core)\r\n    let transcriptText = '';\r\n    try {\r\n      console.log(`Fetching info for video: ${videoId}`);\r\n      const info = await ytdl.getInfo(videoId);\r\n      const tracks = info.player_response.captions?.playerCaptionsTracklistRenderer?.captionTracks;\r\n\r\n      if (!tracks || tracks.length === 0) {\r\n        throw new Error('No captions found for this video.');\r\n      }\r\n\r\n      // Prioritize English, then English (Auto), then any\r\n      const track = tracks.find((t: any) => t.languageCode === 'en' && !t.kind) \r\n                 || tracks.find((t: any) => t.languageCode === 'en') \r\n                 || tracks[0];\r\n\r\n      console.log(`Using caption track: ${track.name.simpleText} (${track.languageCode})`);\r\n\r\n      // Fetch the transcript in JSON format\r\n      const response = await fetch(`${track.baseUrl}&fmt=json3`);\r\n      const data = await response.json();\r\n\r\n      if (data?.events) {\r\n        transcriptText = data.events\r\n          .filter((event: any) => event.segs)\r\n          .map((event: any) => event.segs.map((seg: any) => seg.utf8).join(''))\r\n          .join(' ')\r\n          .replace(/[\\n\\r]/g, ' ');\r\n      }\r\n    } catch (transcriptError: any) {\r\n      console.error('Transcript fetch error:', transcriptError);\r\n      return NextResponse.json(\r\n        { message: `Failed to fetch transcript: ${transcriptError.message}. The video might not have captions.` },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!transcriptText || transcriptText.length < 50) {\r\n      return NextResponse.json(\r\n        { message: 'Transcript is too short or empty.' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // 5. Generate Summary with Gemini\r\n    const prompt = `\r\n      You are an expert academic tutor. Summarize the following YouTube video transcript into a structured set of study notes.\r\n      \r\n      Format the output using Markdown.\r\n      Include the following sections:\r\n      1. **Core Concept**: A concise explanation of the main topic (~2-3 sentences).\r\n      2. **Detailed Breakdown**: Bullet points explaining key ideas, arguments, or steps. Use nested bullets if necessary.\r\n      3. **Summary**: A concluding paragraph wrapping up the lesson.\r\n\r\n      Transcript:\r\n      ${transcriptText}\r\n    `;\r\n\r\n    const result = await model.generateContent(prompt);\r\n    const summaryContent = result.response.text();\r\n\r\n    // 6. Save to Database\r\n    await pool.query(\r\n      'INSERT INTO summaries (user_id, video_url, summary_content) VALUES ($1, $2, $3)',\r\n      [userId, videoUrl, summaryContent]\r\n    );\r\n\r\n    return NextResponse.json({ summary: summaryContent }, { status: 200 });\r\n\r\n  } catch (error) {\r\n    console.error('Summarization error:', error);\r\n    return NextResponse.json({ message: 'Internal server error while generating summary.' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}