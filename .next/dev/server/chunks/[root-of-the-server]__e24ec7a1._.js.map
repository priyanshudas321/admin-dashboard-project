{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/lib/db.ts"],"sourcesContent":["import { Pool } from \"pg\";\r\n\r\nlet pool: Pool;\r\n\r\nif (!process.env.DATABASE_URL) {\r\n  throw new Error(\r\n    \"Please define the DATABASE_URL environment variable inside .env\",\r\n  );\r\n}\r\n\r\nconst poolConfig: any = {\r\n  connectionString: process.env.DATABASE_URL,\r\n  max: 10, // Max number of clients in the pool\r\n  idleTimeoutMillis: 30000, // How long a client is allowed to remain idle before being closed\r\n  connectionTimeoutMillis: 2000, // How long to wait for a connection\r\n};\r\n\r\n// Check for production or if using NeonDB (which requires SSL)\r\nif (process.env.NODE_ENV === 'production' || process.env.DATABASE_URL?.includes('neondb')) {\r\n  // Use explicit SSL configuration to avoid 'prefer' alias warning\r\n  poolConfig.ssl = {\r\n    rejectUnauthorized: false, // For self-signed certs or NeonDB compatibility\r\n    // Alternatively, use 'verify-full' if you have the CA cert\r\n  };\r\n  pool = new Pool(poolConfig);\r\n} else {\r\n  // In development mode, use a global variable so that the value\r\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\r\n  if (!(global as any).pgPool) {\r\n    (global as any).pgPool = new Pool(poolConfig);\r\n  }\r\n  pool = (global as any).pgPool;\r\n}\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,IAAI;AAEJ,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MACR;AAEJ;AAEA,MAAM,aAAkB;IACtB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAEA,+DAA+D;AAC/D,IAAI,oDAAyB,gBAAgB,QAAQ,GAAG,CAAC,YAAY,EAAE,SAAS,WAAW;IACzF,iEAAiE;IACjE,WAAW,GAAG,GAAG;QACf,oBAAoB;IAEtB;IACA,OAAO,IAAI,qJAAI,CAAC;AAClB,OAAO;IACL,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,CAAC,yDAAgB,MAAM,EAAE;QAC3B,yDAAgB,MAAM,GAAG,IAAI,qJAAI,CAAC;IACpC;IACA,OAAO,yDAAgB,MAAM;AAC/B;uCAEe"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/lib/auth.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'development_secret_key_123';\r\n\r\nif (process.env.NODE_ENV === 'production' && !process.env.JWT_SECRET) {\r\n  throw new Error('JWT_SECRET must be set in production environment');\r\n}\r\n\r\nexport async function hashPassword(password: string): Promise<string> {\r\n  const salt = await bcrypt.genSalt(10);\r\n  return bcrypt.hash(password, salt);\r\n}\r\n\r\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\r\n  return bcrypt.compare(password, hash);\r\n}\r\n\r\nexport function generateToken(payload: any): string {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '1d' });\r\n}\r\n\r\nexport function verifyToken(token: string): any {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE7C;;AAIO,eAAe,aAAa,QAAgB;IACjD,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;IAClC,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,cAAc,OAAY;IACxC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport pool from '@/lib/db';\r\nimport { comparePassword, generateToken } from '@/lib/auth';\r\nimport { cookies } from 'next/headers';\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { email, password } = await req.json();\r\n\r\n    if (!email || !password) {\r\n      return NextResponse.json(\r\n        { message: 'Email and password are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Use pool.query directly for single queries to let the pool manage the client\r\n    const result = await pool.query(\r\n      'SELECT * FROM users WHERE email = $1',\r\n      [email]\r\n    );\r\n\r\n    const user = result.rows[0];\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { message: 'Invalid credentials' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Support both 'password' and 'password_hash' column names\r\n    const dbPassword = user.password || user.password_hash;\r\n    \r\n    if (!dbPassword) {\r\n        console.error('Password column not found in user record', { id: user.id });\r\n        return NextResponse.json(\r\n             { message: 'Internal server error' },\r\n             { status: 500 }\r\n        );\r\n    }\r\n\r\n    const isValidPassword = await comparePassword(password, dbPassword);\r\n\r\n    if (!isValidPassword) {\r\n      return NextResponse.json(\r\n        { message: 'Invalid credentials' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Check approval status (supports is_approved boolean column)\r\n    // Some schemas might use 'status', others 'is_approved'\r\n    const isApproved = user.is_approved === true || user.status === 'approved';\r\n\r\n    if (!isApproved) {\r\n      return NextResponse.json(\r\n        { message: 'Your account is pending approval. Please wait for an admin to approve your request.' },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // Generate JWT\r\n    const token = generateToken({\r\n      id: user.id,\r\n      email: user.email,\r\n      role: user.role,\r\n      status: user.status\r\n    });\r\n\r\n    // Set cookie\r\n    const cookieStore = await cookies();\r\n    cookieStore.set('token', token, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'strict',\r\n      maxAge: 60 * 60 * 24 // 1 day\r\n    });\r\n\r\n    return NextResponse.json(\r\n      { \r\n        message: 'Login successful',\r\n        user: {\r\n          id: user.id,\r\n          email: user.email,\r\n          role: user.role,\r\n          status: user.status\r\n        }\r\n      },\r\n      { status: 200 }\r\n    );\r\n  } catch (error: any) {\r\n    console.error('Login error detailed:', {\r\n      message: error.message,\r\n      stack: error.stack,\r\n      code: error.code\r\n    });\r\n    return NextResponse.json(\r\n      { message: `Internal server error: ${error.message}` },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAE1C,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAkC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,+EAA+E;QAC/E,MAAM,SAAS,MAAM,sHAAI,CAAC,KAAK,CAC7B,wCACA;YAAC;SAAM;QAGT,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;QAE3B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAsB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,2DAA2D;QAC3D,MAAM,aAAa,KAAK,QAAQ,IAAI,KAAK,aAAa;QAEtD,IAAI,CAAC,YAAY;YACb,QAAQ,KAAK,CAAC,4CAA4C;gBAAE,IAAI,KAAK,EAAE;YAAC;YACxE,OAAO,gJAAY,CAAC,IAAI,CACnB;gBAAE,SAAS;YAAwB,GACnC;gBAAE,QAAQ;YAAI;QAEvB;QAEA,MAAM,kBAAkB,MAAM,IAAA,gIAAe,EAAC,UAAU;QAExD,IAAI,CAAC,iBAAiB;YACpB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAsB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,8DAA8D;QAC9D,wDAAwD;QACxD,MAAM,aAAa,KAAK,WAAW,KAAK,QAAQ,KAAK,MAAM,KAAK;QAEhE,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAsF,GACjG;gBAAE,QAAQ;YAAI;QAElB;QAEA,eAAe;QACf,MAAM,QAAQ,IAAA,8HAAa,EAAC;YAC1B,IAAI,KAAK,EAAE;YACX,OAAO,KAAK,KAAK;YACjB,MAAM,KAAK,IAAI;YACf,QAAQ,KAAK,MAAM;QACrB;QAEA,aAAa;QACb,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,YAAY,GAAG,CAAC,SAAS,OAAO;YAC9B,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK,GAAG,QAAQ;QAC/B;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;gBACf,QAAQ,KAAK,MAAM;YACrB;QACF,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;YACrC,SAAS,MAAM,OAAO;YACtB,OAAO,MAAM,KAAK;YAClB,MAAM,MAAM,IAAI;QAClB;QACA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS,CAAC,uBAAuB,EAAE,MAAM,OAAO,EAAE;QAAC,GACrD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}