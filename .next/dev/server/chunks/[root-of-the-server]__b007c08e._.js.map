{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/lib/db.ts"],"sourcesContent":["import { Pool } from \"pg\";\r\n\r\nlet pool: Pool;\r\n\r\nif (!process.env.DATABASE_URL) {\r\n  throw new Error(\r\n    \"Please define the DATABASE_URL environment variable inside .env\",\r\n  );\r\n}\r\n\r\nconst poolConfig: any = {\r\n  connectionString: process.env.DATABASE_URL,\r\n  max: 10, // Max number of clients in the pool\r\n  idleTimeoutMillis: 30000, // How long a client is allowed to remain idle before being closed\r\n  connectionTimeoutMillis: 2000, // How long to wait for a connection\r\n};\r\n\r\n// Check for production or if using NeonDB (which requires SSL)\r\nif (process.env.NODE_ENV === 'production' || process.env.DATABASE_URL?.includes('neondb')) {\r\n  // Use explicit SSL configuration to avoid 'prefer' alias warning\r\n  poolConfig.ssl = {\r\n    rejectUnauthorized: false, // For self-signed certs or NeonDB compatibility\r\n    // Alternatively, use 'verify-full' if you have the CA cert\r\n  };\r\n  pool = new Pool(poolConfig);\r\n} else {\r\n  // In development mode, use a global variable so that the value\r\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\r\n  if (!(global as any).pgPool) {\r\n    (global as any).pgPool = new Pool(poolConfig);\r\n  }\r\n  pool = (global as any).pgPool;\r\n}\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,IAAI;AAEJ,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MACR;AAEJ;AAEA,MAAM,aAAkB;IACtB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAEA,+DAA+D;AAC/D,IAAI,oDAAyB,gBAAgB,QAAQ,GAAG,CAAC,YAAY,EAAE,SAAS,WAAW;IACzF,iEAAiE;IACjE,WAAW,GAAG,GAAG;QACf,oBAAoB;IAEtB;IACA,OAAO,IAAI,qJAAI,CAAC;AAClB,OAAO;IACL,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,CAAC,yDAAgB,MAAM,EAAE;QAC3B,yDAAgB,MAAM,GAAG,IAAI,qJAAI,CAAC;IACpC;IACA,OAAO,yDAAgB,MAAM;AAC/B;uCAEe"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/lib/auth.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'development_secret_key_123';\r\n\r\nif (process.env.NODE_ENV === 'production' && !process.env.JWT_SECRET) {\r\n  throw new Error('JWT_SECRET must be set in production environment');\r\n}\r\n\r\nexport async function hashPassword(password: string): Promise<string> {\r\n  const salt = await bcrypt.genSalt(10);\r\n  return bcrypt.hash(password, salt);\r\n}\r\n\r\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\r\n  return bcrypt.compare(password, hash);\r\n}\r\n\r\nexport function generateToken(payload: any): string {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '1d' });\r\n}\r\n\r\nexport function verifyToken(token: string): any {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE7C;;AAIO,eAAe,aAAa,QAAgB;IACjD,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;IAClC,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,cAAc,OAAY;IACxC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///E:/vs%20code/antigravity%20related%20test%20projects/react%20dashboard%20project/admin-dashboard-type2/app/api/admin/users/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport pool from '@/lib/db';\r\nimport { cookies } from 'next/headers';\r\nimport { verifyToken } from '@/lib/auth';\r\n\r\nexport async function PATCH(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const { id } = await params;\r\n    const { status, role } = await req.json();\r\n\r\n    // Protection for Main Admin\r\n    // We need to fetch the user being updated first to check their email\r\n    const targetUserRes = await pool.query('SELECT email FROM users WHERE id = $1', [id]);\r\n    if (targetUserRes.rows.length > 0) {\r\n        const targetEmail = targetUserRes.rows[0].email;\r\n        if (targetEmail === 'test@test.com' && role) {\r\n            return NextResponse.json({ message: 'Cannot modify Main Admin role' }, { status: 403 });\r\n        }\r\n    }\r\n\r\n    if (status && !['pending', 'approved'].includes(status)) {\r\n       return NextResponse.json({ message: 'Invalid status' }, { status: 400 });\r\n    }\r\n\r\n    if (role && !['admin', 'user'].includes(role)) {\r\n        return NextResponse.json({ message: 'Invalid role' }, { status: 400 });\r\n    }\r\n\r\n    const cookieStore = await cookies();\r\n    const token = cookieStore.get('token')?.value;\r\n\r\n    if (!token) {\r\n      return NextResponse.json({ message: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const user = verifyToken(token);\r\n    if (!user || user.role !== 'admin') {\r\n      return NextResponse.json({ message: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    // Build dynamic query\r\n    let query = 'UPDATE users SET ';\r\n    const values = [];\r\n    let paramIndex = 1;\r\n\r\n    if (status) {\r\n        // Map status string to is_approved boolean\r\n        query += `is_approved = $${paramIndex}, `;\r\n        values.push(status === 'approved');\r\n        paramIndex++;\r\n    }\r\n    if (role) {\r\n        query += `role = $${paramIndex}, `;\r\n        values.push(role);\r\n        paramIndex++;\r\n    }\r\n\r\n    // Remove trailing comma and space\r\n    query = query.slice(0, -2); \r\n    \r\n    // Return mapped status for frontend consistency\r\n    query += ` WHERE id = $${paramIndex} RETURNING id, email, \r\n      CASE WHEN is_approved = true THEN 'approved' ELSE 'pending' END as status, \r\n      role`;\r\n    values.push(id);\r\n\r\n    const result = await pool.query(query, values);\r\n\r\n    if (result.rowCount === 0) {\r\n      return NextResponse.json({ message: 'User not found' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json(result.rows[0]);\r\n  } catch (error) {\r\n    console.error('Update user error:', error);\r\n    return NextResponse.json({ message: 'Internal server error' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEO,eAAe,MAAM,GAAY,EAAE,EAAE,MAAM,EAAuC;IACvF,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QAEvC,4BAA4B;QAC5B,qEAAqE;QACrE,MAAM,gBAAgB,MAAM,sHAAI,CAAC,KAAK,CAAC,yCAAyC;YAAC;SAAG;QACpF,IAAI,cAAc,IAAI,CAAC,MAAM,GAAG,GAAG;YAC/B,MAAM,cAAc,cAAc,IAAI,CAAC,EAAE,CAAC,KAAK;YAC/C,IAAI,gBAAgB,mBAAmB,MAAM;gBACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;gBAAgC,GAAG;oBAAE,QAAQ;gBAAI;YACzF;QACJ;QAEA,IAAI,UAAU,CAAC;YAAC;YAAW;SAAW,CAAC,QAAQ,CAAC,SAAS;YACtD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,IAAI,QAAQ,CAAC;YAAC;YAAS;SAAO,CAAC,QAAQ,CAAC,OAAO;YAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,UAAU;QAExC,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,OAAO,IAAA,4HAAW,EAAC;QACzB,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,SAAS;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAY,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,sBAAsB;QACtB,IAAI,QAAQ;QACZ,MAAM,SAAS,EAAE;QACjB,IAAI,aAAa;QAEjB,IAAI,QAAQ;YACR,2CAA2C;YAC3C,SAAS,CAAC,eAAe,EAAE,WAAW,EAAE,CAAC;YACzC,OAAO,IAAI,CAAC,WAAW;YACvB;QACJ;QACA,IAAI,MAAM;YACN,SAAS,CAAC,QAAQ,EAAE,WAAW,EAAE,CAAC;YAClC,OAAO,IAAI,CAAC;YACZ;QACJ;QAEA,kCAAkC;QAClC,QAAQ,MAAM,KAAK,CAAC,GAAG,CAAC;QAExB,gDAAgD;QAChD,SAAS,CAAC,aAAa,EAAE,WAAW;;UAE9B,CAAC;QACP,OAAO,IAAI,CAAC;QAEZ,MAAM,SAAS,MAAM,sHAAI,CAAC,KAAK,CAAC,OAAO;QAEvC,IAAI,OAAO,QAAQ,KAAK,GAAG;YACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,EAAE;IACzC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF"}}]
}